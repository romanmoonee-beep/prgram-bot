# üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PR GRAM Bot

## üìä –û–±–∑–æ—Ä —Ç–∞–±–ª–∏—Ü

### üë• **users** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã
**–û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –±–∞–ª–∞–Ω—Å–æ–º –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | INTEGER PK | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `telegram_id` | BIGINT UNIQUE | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram |
| `username` | VARCHAR(32) | Username –≤ Telegram |
| `first_name` | VARCHAR(64) | –ò–º—è |
| `last_name` | VARCHAR(64) | –§–∞–º–∏–ª–∏—è |
| `balance` | INTEGER | –ë–∞–ª–∞–Ω—Å GRAM |
| `frozen_balance` | INTEGER | –ó–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å |
| `level` | VARCHAR(20) | –£—Ä–æ–≤–µ–Ω—å (bronze/silver/gold/premium) |
| `referrer_id` | INTEGER FK | ID —Ä–µ—Ñ–µ—Ä–µ—Ä–∞ |
| `referral_code` | VARCHAR(50) UNIQUE | –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ |
| `is_active` | BOOLEAN | –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ –∞–∫–∫–∞—É–Ω—Ç |
| `is_banned` | BOOLEAN | –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ª–∏ |

### üìã **tasks** - –ó–∞–¥–∞–Ω–∏—è
**–¢–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö –∑–∞–¥–∞–Ω–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | INTEGER PK | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `author_id` | INTEGER FK | –°–æ–∑–¥–∞—Ç–µ–ª—å –∑–∞–¥–∞–Ω–∏—è |
| `type` | VARCHAR(50) | –¢–∏–ø (subscribe_channel/join_group/view_post/bot_interaction/react_post) |
| `title` | VARCHAR(200) | –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è |
| `target_url` | TEXT | –°—Å—ã–ª–∫–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |
| `reward` | INTEGER | –ù–∞–≥—Ä–∞–¥–∞ –≤ GRAM |
| `total_executions` | INTEGER | –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π |
| `remaining_executions` | INTEGER | –û—Å—Ç–∞–≤—à–∏–µ—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |
| `auto_check` | BOOLEAN | –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ |
| `status` | VARCHAR(20) | –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞–Ω–∏—è |
| `expires_at` | TIMESTAMP | –î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è |

### ‚úÖ **task_executions** - –í—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π
**–¢–∞–±–ª–∏—Ü–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | INTEGER PK | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `task_id` | INTEGER FK | ID –∑–∞–¥–∞–Ω–∏—è |
| `user_id` | INTEGER FK | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `status` | VARCHAR(20) | –°—Ç–∞—Ç—É—Å (pending/completed/rejected) |
| `screenshot_url` | TEXT | –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç |
| `reward_amount` | INTEGER | –†–∞–∑–º–µ—Ä –Ω–∞–≥—Ä–∞–¥—ã |
| `checked_by_id` | INTEGER FK | –ö—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏–ª |

### üí∏ **transactions** - –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
**–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å GRAM –≤ —Å–∏—Å—Ç–µ–º–µ**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | INTEGER PK | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `user_id` | INTEGER FK | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `type` | VARCHAR(50) | –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| `amount` | INTEGER | –°—É–º–º–∞ |
| `balance_before` | INTEGER | –ë–∞–ª–∞–Ω—Å –¥–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| `balance_after` | INTEGER | –ë–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| `description` | TEXT | –û–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| `status` | VARCHAR(20) | –°—Ç–∞—Ç—É—Å –æ–ø–µ—Ä–∞—Ü–∏–∏ |

### üí≥ **checks** - –°–∏—Å—Ç–µ–º–∞ —á–µ–∫–æ–≤
**–ß–µ–∫–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ GRAM**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | INTEGER PK | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `creator_id` | INTEGER FK | –°–æ–∑–¥–∞—Ç–µ–ª—å —á–µ–∫–∞ |
| `code` | VARCHAR(32) UNIQUE | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ —á–µ–∫–∞ |
| `type` | VARCHAR(20) | –¢–∏–ø (personal/multi) |
| `total_amount` | INTEGER | –û–±—â–∞—è —Å—É–º–º–∞ |
| `max_activations` | INTEGER | –ú–∞–∫—Å–∏–º—É–º –∞–∫—Ç–∏–≤–∞—Ü–∏–π |
| `current_activations` | INTEGER | –¢–µ–∫—É—â–∏–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ |

### üéØ **check_activations** - –ê–∫—Ç–∏–≤–∞—Ü–∏–∏ —á–µ–∫–æ–≤
**–ö—Ç–æ –∏ –∫–æ–≥–¥–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª —á–µ–∫–∏**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | INTEGER PK | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `check_id` | INTEGER FK | ID —á–µ–∫–∞ |
| `user_id` | INTEGER FK | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `amount` | INTEGER | –ü–æ–ª—É—á–µ–Ω–Ω–∞—è —Å—É–º–º–∞ |
| `activated_at` | TIMESTAMP | –î–∞—Ç–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ |

### üîî **notifications** - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
**–°–∏—Å—Ç–µ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | INTEGER PK | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `user_id` | INTEGER FK | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `type` | VARCHAR(50) | –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| `title` | VARCHAR(255) | –ó–∞–≥–æ–ª–æ–≤–æ–∫ |
| `message` | TEXT | –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è |
| `is_read` | BOOLEAN | –ü—Ä–æ—á–∏—Ç–∞–Ω–æ –ª–∏ |
| `priority` | INTEGER | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (1-4) |

## üîó –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–≤—è–∑–∏:

1. **users ‚Üí users** (Self-referencing)
   - `users.referrer_id` ‚Üí `users.id`
   - –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

2. **users ‚Üí tasks** (One-to-Many)
   - `tasks.author_id` ‚Üí `users.id`
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –∑–∞–¥–∞–Ω–∏—è

3. **tasks ‚Üí task_executions** (One-to-Many)
   - `task_executions.task_id` ‚Üí `tasks.id`
   - –ó–∞–¥–∞–Ω–∏–µ –∏–º–µ–µ—Ç –º–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π

4. **users ‚Üí task_executions** (One-to-Many)
   - `task_executions.user_id` ‚Üí `users.id`
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞–Ω–∏—è

5. **users ‚Üí transactions** (One-to-Many)
   - `transactions.user_id` ‚Üí `users.id`
   - –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

6. **users ‚Üí checks** (One-to-Many)
   - `checks.creator_id` ‚Üí `users.id`
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç —á–µ–∫–∏

7. **checks ‚Üí check_activations** (One-to-Many)
   - `check_activations.check_id` ‚Üí `checks.id`
   - –ê–∫—Ç–∏–≤–∞—Ü–∏–∏ —á–µ–∫–∞

## üìà –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
CREATE INDEX idx_users_telegram_id ON users(telegram_id);
CREATE INDEX idx_users_referrer_id ON users(referrer_id);
CREATE INDEX idx_users_level_balance ON users(level, balance);

-- –ó–∞–¥–∞–Ω–∏—è  
CREATE INDEX idx_tasks_author_id ON tasks(author_id);
CREATE INDEX idx_tasks_type_status ON tasks(type, status);
CREATE INDEX idx_tasks_expires_at ON tasks(expires_at);

-- –í—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π
CREATE UNIQUE INDEX idx_task_executions_unique ON task_executions(task_id, user_id);
CREATE INDEX idx_task_executions_status ON task_executions(status);
CREATE INDEX idx_task_executions_user_id ON task_executions(user_id);

-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
CREATE INDEX idx_transactions_user_id ON transactions(user_id);
CREATE INDEX idx_transactions_type ON transactions(type);
CREATE INDEX idx_transactions_created_at ON transactions(created_at);

-- –ß–µ–∫–∏
CREATE INDEX idx_checks_code ON checks(code);
CREATE INDEX idx_checks_creator_id ON checks(creator_id);
CREATE INDEX idx_checks_is_active ON checks(is_active);

-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
CREATE INDEX idx_notifications_user_read ON notifications(user_id, is_read);
```

## üîí –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –ø—Ä–∞–≤–∏–ª–∞

### –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- `users.telegram_id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π Telegram ID
- `users.referral_code` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥  
- `checks.code` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ —á–µ–∫–∞
- `task_executions(task_id, user_id)` - –æ–¥–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- `users.balance >= 0` - –±–∞–ª–∞–Ω—Å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º
- `tasks.reward > 0` - –Ω–∞–≥—Ä–∞–¥–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π
- `transactions.amount > 0` - —Å—É–º–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è

## üíæ –†–∞–∑–º–µ—Ä –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–∏–º–µ—Ä–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤:

| –¢–∞–±–ª–∏—Ü–∞ | –ó–∞–ø–∏—Å–µ–π (1 –≥–æ–¥) | –†–∞–∑–º–µ—Ä |
|---------|-----------------|--------|
| users | ~100,000 | ~50 MB |
| tasks | ~500,000 | ~200 MB |
| task_executions | ~5,000,000 | ~2 GB |
| transactions | ~10,000,000 | ~3 GB |
| notifications | ~20,000,000 | ~4 GB |
| checks | ~50,000 | ~20 MB |

### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü –ø–æ –¥–∞—Ç–µ
- –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Redis
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

## üîß –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ Sequelize –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
npx sequelize migration:generate --name add-new-field

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
npm run migrate

# –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
npx sequelize db:migrate:undo
```